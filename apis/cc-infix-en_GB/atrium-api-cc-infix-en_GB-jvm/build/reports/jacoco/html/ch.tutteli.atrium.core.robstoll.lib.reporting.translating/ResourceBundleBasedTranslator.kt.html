<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ResourceBundleBasedTranslator.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">atrium-api-cc-infix-en_GB-jvm</a> &gt; <a href="index.source.html" class="el_package">ch.tutteli.atrium.core.robstoll.lib.reporting.translating</a> &gt; <span class="el_source">ResourceBundleBasedTranslator.kt</span></div><h1>ResourceBundleBasedTranslator.kt</h1><pre class="source lang-java linenums">package ch.tutteli.atrium.core.robstoll.lib.reporting.translating

import ch.tutteli.atrium.reporting.translating.*
import ch.tutteli.atrium.reporting.translating.Locale
import ch.tutteli.kbox.forElementAndForEachIn
import java.util.*

/**
 * Represents a [Translator] which reuses [ResourceBundle] properties based capabilities but uses an enhanced
 * fallback mechanism.
 *
 * Instead of falling back to [java.util.Locale.getDefault] one is able to specify fallback [Locale] oneself.
 * Whether this includes [java.util.Locale.getDefault] or not is up to the user.
 *
 * The translations are located in properties files structured per entity (enum, object or class).
 * For instance, the translations for `ch.tutteli.atrium.DescriptionAnyAssertion` and the [Locale] `de_CH` are
 * stored in a properties file named `DescriptionAnyAssertion_de_CH.properties` in the folder `/ch/tutteli/atrium/`.
 *
 * An entry in such a file would look like as follows:
 * `TO_BE = a translation for TO_BE`
 *
 * This class is only used as reference implementation to see that compatibility with ResourceBundle is still given.
 *
 * @constructor  Represents a [Translator] which reuses [ResourceBundle] properties based capabilities but uses
 *   an enhanced fallback mechanism. Instead of falling back to [java.util.Locale.getDefault] one is able to
 *   specify fallback [Locale] oneself. Whether this includes [java.util.Locale.getDefault] or not is up to the user.
 * @param primaryLocale The [Locale] to which the translator translates per default as well as the [Locale]
 *   which will be used in [java.lang.String.format], which in turn is used to substitute the placeholders in the
 *   resulting translation of [TranslatableWithArgs.translatable] with the [TranslatableWithArgs.arguments].
 * @param fallbackLocales Used in case a translation for a given [Translatable] is not defined for
 *   [primaryLocale] or one of its secondary alternatives -- the fallback [Locale]s are used in the given order.
 */
<span class="nc" id="L33">internal class ResourceBundleBasedTranslator(</span>
    primaryLocale: Locale,
    fallbackLocales: List&lt;Locale&gt;
<span class="nc" id="L36">) : ArgumentsSupportingTranslator(primaryLocale, fallbackLocales) {</span>

    override fun translateWithoutArgs(translatable: Translatable): String {
<span class="nc" id="L39">        val control = ResourceBundle.Control.getNoFallbackControl(ResourceBundle.Control.FORMAT_PROPERTIES)</span>
<span class="nc" id="L40">        forElementAndForEachIn(primaryLocale, fallbackLocales) { locale -&gt;</span>
<span class="nc" id="L41">            try {</span>
<span class="nc" id="L42">                val bundle = ResourceBundle.getBundle(translatable::class.java.name, locale.toJavaLocale(), control)</span>
<span class="nc" id="L43">                return bundle.getString(translatable.name)</span>
<span class="nc" id="L44">            } catch (ex: MissingResourceException) {</span>
                //that's fine we'll return getDefault below if no translation was found
            }
<span class="nc" id="L47">        }</span>
<span class="nc" id="L48">        return translatable.getDefault()</span>
    }

    companion object {
        /**
         * Creates a [ResourceBundleBasedTranslator] and aggregates it with a [ResourceBundle.Control] which either
         * makes use of the given [fallbackLocales] if provided or uses only the given [primaryLocale].
         *
         * @param primaryLocale The primary [Locale] which will be used in [java.lang.String.format] to substitute the
         *   placeholders in the resulting translation of [TranslatableWithArgs.translatable] with
         *   the [TranslatableWithArgs.arguments].
         * @param fallbackLocales Used in case a translation for a given [Translatable] is not defined for
         *   [primaryLocale] or one of its secondary alternatives -- the [fallbackLocales] are used in the
         *   given order.
         */
        fun create(primaryLocale: Locale, vararg fallbackLocales: Locale) =
<span class="nc" id="L64">            ResourceBundleBasedTranslator(primaryLocale, fallbackLocales.toList())</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>